(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-28692b6c"],{"0e71":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"content-warp"},[a("div",{staticClass:"tool-bar"},[a("div",{staticClass:"selectForm"},[a("div",{staticClass:"select-item"},[e._v(e._s(e.$t("views.agentManage.state"))+"：")]),e._l(e.stateOptions,(function(t){return a("div",{key:t.value,staticClass:"select-item",class:t.value===e.state&&"active",on:{click:function(a){return e.changeState(t)}}},[e._v(" "+e._s(t.label)+" ")])}))],2),a("div",{staticClass:"tool-bar"},[a("el-input",{staticStyle:{"margin-left":"12px"},attrs:{size:"small",placeholder:e.$t("views.agentManage.searchValue")},on:{input:e.searchTable},model:{value:e.searchValue,callback:function(t){e.searchValue=t},expression:"searchValue"}})],1)]),a("div",{staticClass:"button-bar"},[a("div",{staticStyle:{color:"rgb(56, 67, 90)"}},[e._v(" "+e._s(e.$t("views.agentManage.choose"))+" "),a("span",{staticStyle:{color:"rgb(74, 114, 174)"}},[e._v(e._s(e.multipleSelection.length))]),e._v(" "+e._s(e.$t("views.agentManage.strip"))+" ")]),a("div",[a("el-button",{staticClass:"resetAllBtn",attrs:{size:"small",disabled:!e.state},on:{click:function(t){return e.agentStart(0)}}},[e._v(" "+e._s(e.$t("views.agentManage.on")))]),a("el-button",{staticClass:"resetAllBtn",attrs:{size:"small",disabled:!e.state},on:{click:function(t){return e.agentStop(0)}}},[e._v(" "+e._s(e.$t("views.agentManage.off")))]),a("el-button",{staticClass:"resetAllBtn",attrs:{size:"small"},on:{click:e.deleteAgents}},[e._v(" "+e._s(e.$t("views.agentManage.del")))])],1)]),a("el-table",{staticClass:"agentManageTable",attrs:{data:e.tableData,border:"","header-align":"center"},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),a("el-table-column",{attrs:{label:e.$t("views.agentManage.projectName"),prop:"project_name",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[a("div",{staticClass:"dot"},[e._v(" "+e._s(s.project_name)+" ")])]}}])}),a("el-table-column",{attrs:{label:e.$t("views.agentManage.address"),prop:"server",width:"180px"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[a("div",{staticClass:"dot"},[e._v(" "+e._s(s.server)+" ")])]}}])}),a("el-table-column",{attrs:{width:"150",label:e.$t("views.agentManage.payload"),prop:"system_load"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[a("div",{staticClass:"dot"},[e._v(" "+e._s(s.system_load?s.system_load.rate:"")+" ")])]}}])}),a("el-table-column",{attrs:{label:e.$t("views.agentManage.flow")+" ("+e.$t("views.agentManage.step")+")",prop:"is_core_running",width:"140px"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[a("div",[e._v(e._s(s.flow||0))])]}}])}),a("el-table-column",{attrs:{label:e.$t("views.agentManage.method_queue")+" ("+e.$t("views.agentManage.item")+")",prop:"server",width:"170px"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[a("div",{staticClass:"dot"},[e._v(" "+e._s(s.method_queue)+" ")])]}}])}),a("el-table-column",{attrs:{label:e.$t("views.agentManage.replay_queue")+" ("+e.$t("views.agentManage.item")+")",width:"160px",prop:"server"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[a("div",{staticClass:"dot"},[e._v(" "+e._s(s.replay_queue)+" ")])]}}])}),a("el-table-column",{attrs:{label:e.$t("views.agentManage.report_queue")+" ("+e.$t("views.agentManage.item")+")",width:"160px",prop:"server"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[a("div",{staticClass:"dot"},[e._v(" "+e._s(s.report_queue)+" ")])]}}])}),a("el-table-column",{attrs:{label:e.$t("views.agentManage.status"),prop:"is_core_running",width:"130px"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[a("div",[e._v(" "+e._s(1==s.is_core_running?e.$t("views.agentManage.is_core_running"):e.$t("views.agentManage.is_core_not_running"))+" ")])]}}])}),a("el-table-column",{attrs:{label:e.$t("views.agentManage.healthy"),prop:"running_status",width:"130px"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[a("div",[e._v(" "+e._s(s.running_status)+" ")])]}}])}),a("el-table-column",{attrs:{width:"170px",label:e.$t("views.agentManage.timestapm")},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("formatTimestamp")(t.row.latest_time))+" "),a("el-popover",{attrs:{placement:"top-start",width:"170",trigger:"hover"}},[a("p",{staticStyle:{"font-size":"12px",color:"#ccc","margin-bottom":"6px"}},[e._v(" Agent 注册时间: ")]),a("p",[e._v(e._s(e._f("formatTimestamp")(t.row.register_time)))]),a("i",{staticClass:"el-icon-info",attrs:{slot:"reference"},slot:"reference"})])]}}])}),1===e.userInfo.role||2===e.userInfo.role?a("el-table-column",{attrs:{label:e.$t("views.agentManage.startupTime"),prop:"startup_time",width:"180px"}}):e._e(),a("el-table-column",{attrs:{label:e.$t("views.agentManage.owner"),prop:"owner",width:"120px"}}),a("el-table-column",{attrs:{label:e.$t("views.agentManage.language"),prop:"language",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[a("div",{staticClass:"dot"},[e._v(" "+e._s(s.language)+" ")])]}}])}),a("el-table-column",{attrs:{label:"Agent",width:"320",prop:"alias"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[s.isEdit?a("div",{staticClass:"edit-agent",staticStyle:{display:"flex","align-items":"center"}},[a("el-input",{staticStyle:{width:"280px"},attrs:{maxlength:"100"},model:{value:s.alias,callback:function(t){e.$set(s,"alias",t)},expression:"row.alias"}}),a("span",{staticClass:"alias-num"},[e._v(e._s(s.alias.length)+"/100")]),a("i",{staticClass:"edit-icon el-icon-check",on:{click:function(t){return e.enterEdit(s)}}}),a("i",{staticClass:"edit-icon el-icon-close",on:{click:function(t){return e.closeEdit(s)}}})],1):a("div",{staticStyle:{display:"flex","align-items":"center"}},[a("div",{staticClass:"dot",staticStyle:{width:"280px"},attrs:{title:s.alias}},[e._v(" "+e._s(s.alias)+" ")]),a("i",{staticClass:"edit-icon el-icon-edit",on:{click:function(t){return e.openEdit(s)}}})])]}}])}),a("el-table-column",{attrs:{label:e.$t("views.agentManage.manage"),width:"360px",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[a("div",{staticClass:"table-btn-box"},[1===s.is_control?[a("el-button",{class:!e.state&&"icon-disabled",staticStyle:{color:"#4a72ae",position:"absolute",left:"0"},attrs:{size:"small",type:"text"}},[a("span",{staticClass:"el-text el-icon-loading"})])]:e._e(),[0==s.is_core_running?a("el-button",{staticStyle:{color:"#4a72ae"},attrs:{type:"text",size:"small",disabled:1===s.is_control},on:{click:function(t){return e.update(s.id,3)}}},[a("span",{staticClass:"el-text"},[e._v(e._s(e.$t("views.agentManage.startUp")))])]):a("el-button",{staticStyle:{color:"#4a72ae"},attrs:{type:"text",size:"small",disabled:1===s.is_control},on:{click:function(t){return e.update(s.id,4)}}},[a("span",{staticClass:"el-text"},[e._v(e._s(e.$t("views.agentManage.suspend")))])])],a("span",{staticClass:"l"},[e._v(" | ")]),2===s.is_core_running?a("el-button",{staticStyle:{color:"#4a72ae"},attrs:{type:"text",size:"small",disabled:1===s.is_control},on:{click:function(t){return e.update(s.id,2)}}},[a("span",{staticClass:"el-text"},[e._v(e._s(e.$t("views.agentManage.register")))])]):e._e(),2!==s.is_core_running?a("el-button",{staticStyle:{color:"#4a72ae"},attrs:{type:"text",size:"small",disabled:1===s.is_control},on:{click:function(t){return e.update(s.id,5)}}},[a("span",{staticClass:"el-text"},[e._v(e._s(e.$t("views.agentManage.uninstall")))])]):e._e(),0!==s.is_core_running?a("span",{staticClass:"l"},[e._v(" | ")]):e._e(),0!==s.is_core_running?a("el-button",{staticStyle:{color:"#4a72ae"},attrs:{type:"text",size:"small",disabled:1===s.is_control},on:{click:function(t){return e.update(s.id,6)}}},[a("span",{staticClass:"el-text"},[e._v(e._s(e.$t("views.agentManage.Demotion")))])]):e._e(),0===s.is_core_running?a("span",{staticClass:"l"},[e._v(" | ")]):e._e(),0===s.is_core_running?a("el-button",{staticStyle:{color:"#4a72ae"},attrs:{type:"text",size:"small",disabled:1===s.is_control},on:{click:function(t){return e.update(s.id,7)}}},[a("span",{staticClass:"el-text"},[e._v(e._s(e.$t("views.agentManage.recovery")))])]):e._e(),a("span",{staticClass:"l"},[e._v(" | ")]),a("el-button",{staticStyle:{color:"#f56262"},attrs:{type:"text",size:"small"},on:{click:function(t){return e.doDelete(s.id)}}},[a("span",{staticClass:"el-text"},[e._v(e._s(e.$t("views.agentManage.delete")))])])],2)]}}])})],1),a("el-pagination",{staticStyle:{float:"right"},attrs:{total:e.total,"current-page":e.page,"page-size":e.pageSize,layout:"total,sizes, prev, pager, next, jumper","page-sizes":[10,20,30,40,50]},on:{"current-change":e.currentChange,"size-change":e.sizeChange}})],1)},n=[],r=a("1da1"),i=a("d4ec"),l=a("bee2"),c=a("262e"),o=a("2caf"),u=(a("d3b7"),a("159b"),a("d81d"),a("a9e3"),a("96cf"),a("9ab4")),g=a("8c73"),p=a("60a3"),h=a("73ec"),d=function(e){Object(c["a"])(a,e);var t=Object(o["a"])(a);function a(){var e;return Object(i["a"])(this,a),e=t.apply(this,arguments),e.tableData=[],e.total=0,e.page=1,e.state=1,e.pageSize=10,e.currentPageSize=0,e.currentPageDelete=0,e.deleteDialogOpen=!1,e.deleteSelectId=0,e.stateOptions=[{value:1,label:e.$t("views.agentManage.running")},{value:0,label:e.$t("views.agentManage.not_running")}],e.searchValue="",e.multipleSelection=[],e}return Object(l["a"])(a,[{key:"update",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t,a){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.services.setting.update_core({id:t,core_status:a});case 2:if(s=e.sent,201!==s.status){e.next=7;break}return this.$message.success(s.msg),this.getTableData(),e.abrupt("return");case 7:this.$message.error(s.msg);case 8:case"end":return e.stop()}}),e,this)})));function t(t,a){return e.apply(this,arguments)}return t}()},{key:"created",value:function(){var e=this;this.getTableData(),this.timer=setInterval((function(){e.reflashTable()}),5e3)}},{key:"searchTable",value:function(){var e=this;this.timeOuter?(clearTimeout(this.timeOuter),this.timeOuter=null):setTimeout((function(){e.getTableData()}),400)}},{key:"openEdit",value:function(e){e.isEdit=!0,e.backAlias=e.alias}},{key:"closeEdit",value:function(e){e.isEdit=!1,e.alias=e.backAlias}},{key:"userInfo",get:function(){return this.$store.getters.userInfo}},{key:"enterEdit",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.services.setting.aliasModified({id:t.id,alias:t.alias});case 2:a=e.sent,201===a.status?(this.$message.success(a.msg),t.isEdit=!1):this.$message.error(a.msg);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"handleSelectionChange",value:function(e){this.multipleSelection=e}},{key:"beforeDestroy",value:function(){clearInterval(this.timer)}},{key:"changeState",value:function(e){var t=this;this.state=e.value,this.page=1,this.getTableData(),1==this.state?this.timer=setInterval((function(){t.getTableData()}),5e3):(clearInterval(this.timer),this.timer=null)}},{key:"currentChange",value:function(e){this.page=parseInt("".concat(e)),this.getTableData()}},{key:"sizeChange",value:function(e){this.pageSize=parseInt("".concat(e)),this.getTableData()}},{key:"reflashTable",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,a,s,n,r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.tableData.some((function(e){return e.isEdit}))){e.next=2;break}return e.abrupt("return");case 2:return t={page:this.page,pageSize:this.pageSize,state:this.state},e.next=5,this.services.setting.agentList(t);case 5:if(a=e.sent,s=a.status,n=a.msg,r=a.data,201===s){e.next=12;break}return this.$message({type:"error",message:n,showClose:!0}),e.abrupt("return");case 12:i={},r&&r.forEach((function(e){return i[e.id]=e})),this.tableData.forEach((function(e){for(var t in e)e[t]=i[e.id][t];try{e.system_load=JSON.parse(e.system_load)}catch(a){e.system_load={rate:0}}}));case 15:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getTableData",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,a,s,n,r,i,l=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={page:this.page,pageSize:this.pageSize,state:this.state,token:this.searchValue},this.loadingStart(),e.next=4,this.services.setting.agentList(t);case 4:if(a=e.sent,s=a.status,n=a.msg,r=a.data,i=a.page,this.loadingDone(),201===s){e.next=13;break}return this.$message({type:"error",message:n,showClose:!0}),e.abrupt("return");case 13:if(!(0===r.length&&this.page>1)){e.next=18;break}return this.page--,e.next=17,this.getTableData();case 17:return e.abrupt("return");case 18:this.tableData=r,this.tableData.forEach((function(e){l.$set(e,"isEdit",!1),l.$set(e,"backAlias","");try{e.system_load=JSON.parse(e.system_load)}catch(t){e.system_load={rate:0}}})),this.currentPageSize=r.length,this.total=i.alltotal,this.currentPageDelete=0;case 23:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"agentInstall",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a,s,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.loadingStart(),e.next=3,this.services.setting.agentInstall({id:parseInt("".concat(t))});case 3:if(a=e.sent,s=a.status,n=a.msg,this.loadingDone(),201===s){e.next=10;break}return this.$message({type:"error",message:n,showClose:!0}),e.abrupt("return");case 10:return e.next=12,this.getTableData();case 12:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"deleteAgents",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(0!==this.multipleSelection.length){e.next=3;break}return this.$message.warning(this.$t("views.agentManage.selectWarning")),e.abrupt("return");case 3:this.$confirm(this.$t("views.agentManage.delAgentInfo"),this.$t("views.agentManage.delAgentPop"),{confirmButtonText:this.$t("views.agentManage.confirmButtonText"),cancelButtonText:this.$t("views.agentManage.cancelButtonText"),type:"warning"}).then(Object(r["a"])(regeneratorRuntime.mark((function e(){var a,s,n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loadingStart(),a={ids:String(t.multipleSelection.map((function(e){return parseInt(e.id)})))},e.next=4,t.services.setting.deleteAgents(a);case 4:if(s=e.sent,n=s.status,r=s.msg,t.loadingDone(),201===n){e.next=11;break}return t.$message({type:"error",message:r,showClose:!0}),e.abrupt("return");case 11:return t.$message({type:"success",message:r,showClose:!0}),e.next=14,t.getTableData();case 14:case"end":return e.stop()}}),e)}))));case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"agentStart",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a,s,n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.state){e.next=2;break}return e.abrupt("return");case 2:if(0!==t){e.next=6;break}if(0!==this.multipleSelection.length){e.next=6;break}return this.$message.warning(this.$t("views.agentManage.selectWarning")),e.abrupt("return");case 6:return this.loadingStart(),a={},a=t?{id:parseInt(t)}:{ids:String(this.multipleSelection.map((function(e){return parseInt(e.id)})))},e.next=11,this.services.setting.agentStart(a);case 11:if(s=e.sent,n=s.status,r=s.msg,this.loadingDone(),201===n){e.next=18;break}return this.$message({type:"error",message:r,showClose:!0}),e.abrupt("return");case 18:return this.$message({type:"success",message:r,showClose:!0}),e.next=21,this.getTableData();case 21:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"agentStop",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a,s,n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.state){e.next=2;break}return e.abrupt("return");case 2:if(0!==t){e.next=6;break}if(0!==this.multipleSelection.length){e.next=6;break}return this.$message.warning(this.$t("views.agentManage.selectWarning")),e.abrupt("return");case 6:return this.loadingStart(),a=t?{id:parseInt(t)}:{ids:String(this.multipleSelection.map((function(e){return parseInt(e.id)})))},e.next=10,this.services.setting.agentStop(a);case 10:if(s=e.sent,n=s.status,r=s.msg,this.loadingDone(),201===n){e.next=17;break}return this.$message({type:"error",message:r,showClose:!0}),e.abrupt("return");case 17:return this.$message({type:"success",message:r,showClose:!0}),e.next=20,this.getTableData();case 20:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"agentUninstall",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a,s,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.loadingStart(),e.next=3,this.services.setting.agentUninstall({id:parseInt("".concat(t))});case 3:if(a=e.sent,s=a.status,n=a.msg,this.loadingDone(),201===s){e.next=10;break}return this.$message({type:"error",message:n,showClose:!0}),e.abrupt("return");case 10:return e.next=12,this.getTableData();case 12:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"doDelete",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.$confirm(this.$t("views.strategyManage.deleteWarning"),this.$t("views.strategyManage.deletePop"),{confirmButtonText:this.$t("views.strategyManage.enter"),cancelButtonText:this.$t("views.strategyManage.clear"),type:"warning"}).then(Object(r["a"])(regeneratorRuntime.mark((function e(){var s,n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=3,a.services.setting.agentDelete({id:Number(t)});case 3:if(s=e.sent,n=s.status,r=s.msg,201===n){e.next=9;break}return a.$message({type:"error",message:r,showClose:!0}),e.abrupt("return");case 9:return a.$message({type:"success",message:r,showClose:!0}),a.currentPageDelete=a.currentPageDelete+1,a.currentPageDelete===a.currentPageSize&&(a.page=a.page-1),e.next=14,a.getTableData();case 14:a.deleteSelectId=0;case 15:case"end":return e.stop()}}),e)}))));case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"agentDelete",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.loadingStart(),e.next=3,this.services.setting.agentDelete({id:this.deleteSelectId});case 3:if(t=e.sent,a=t.status,s=t.msg,this.loadingDone(),201===a){e.next=10;break}return this.$message({type:"error",message:s,showClose:!0}),e.abrupt("return");case 10:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),a}(g["a"]);d=Object(u["b"])([Object(p["a"])({name:"AgentManage",filters:{formatTimestamp:function(e){return Object(h["a"])(e)}}})],d);var v=d,f=v,m=(a("713c"),a("2877")),b=Object(m["a"])(f,s,n,!1,null,"188f1f80",null);t["default"]=b.exports},"713c":function(e,t,a){"use strict";a("a814")},a814:function(e,t,a){}}]);
//# sourceMappingURL=chunk-28692b6c.033131b0.js.map