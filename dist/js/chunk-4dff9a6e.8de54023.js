(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4dff9a6e"],{"0f45":function(e,t,r){"use strict";var s=r("e65c"),a=r("2278").findIndex,i=r("1183"),n="findIndex",l=!0;n in[]&&Array(1)[n]((function(){l=!1})),s({target:"Array",proto:!0,forced:l},{findIndex:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}}),i(n)},"15ee":function(e,t,r){"use strict";var s=r("e65c"),a=r("0785"),i=r("77e4"),n=r("54d5"),l=r("e2c5"),o=r("74e5"),u=r("e541"),c=r("d196"),d=c("splice"),p=Math.max,m=Math.min,h=9007199254740991,w="Maximum allowed length exceeded";s({target:"Array",proto:!0,forced:!d},{splice:function(e,t){var r,s,c,d,f,v,b=l(this),g=n(b.length),k=a(e,g),x=arguments.length;if(0===x?r=s=0:1===x?(r=0,s=g-k):(r=x-2,s=m(p(i(t),0),g-k)),g+r-s>h)throw TypeError(w);for(c=o(b,s),d=0;d<s;d++)f=k+d,f in b&&u(c,d,b[f]);if(c.length=s,r<s){for(d=k;d<g-s;d++)f=d+s,v=d+r,f in b?b[v]=b[f]:delete b[v];for(d=g;d>g-s+r;d--)delete b[d-1]}else if(r>s)for(d=g-s;d>k;d--)f=d+s-1,v=d+r-1,f in b?b[v]=b[f]:delete b[v];for(d=0;d<r;d++)b[d+k]=arguments[d+2];return b.length=g-s+r,c}})},"541b":function(e,t,r){},b0a7:function(e,t,r){"use strict";r("541b")},ea9c:function(e,t,r){"use strict";r.r(t);var s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("main",{staticClass:"container"},[r("div",{staticClass:"userContent"},[r("div",{staticClass:"block",staticStyle:{display:"inline-block",float:"left",width:"340px"}},[r("el-tree",{attrs:{data:e.data,"node-key":"id","default-expand-all":!0,"current-node-key":1,"expand-on-click-node":!1,"check-on-click-node":!1},on:{"node-click":e.SelectNode},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.node,a=t.data;return r("span",{staticClass:"custom-tree-node"},[1==a.isEdit?[r("el-input",{staticClass:"tree-node-input",staticStyle:{height:"20px line-height:20px"},on:{blur:function(){return e.submitEdit(s,a)}},model:{value:e.currentDepartmentName,callback:function(t){e.currentDepartmentName=t},expression:"currentDepartmentName"}})]:r("span",[e._v(e._s(s.label))]),r("span",[-1!=a.id?r("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(){return e.edit(s,a)}}},[e._v(" 修改 ")]):e._e(),r("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(){return e.append(s,a)}}},[e._v(" 新增子部门 ")]),-1!=a.id?r("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(){return e.remove(s,a)}}},[e._v(" 删除 ")]):e._e()],1)],2)}}])})],1),r("div",{staticStyle:{display:"inline-block",width:"828px"}},[r("div",{staticClass:"titleLine flex-row-space-between"},[r("div",{staticClass:"btn",on:{click:e.addDialogShow}},[r("i",{staticClass:"iconfont iconxinzengyonghu"}),e._v(" "+e._s(e.$t("views.userList.addUser"))+" ")]),r("el-input",{staticStyle:{width:"462px"},attrs:{size:"small",placeholder:e.$t("views.userList.keywordPlaceholder")},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.newSelectData(t)}},model:{value:e.keywords,callback:function(t){e.keywords=t},expression:"keywords"}},[r("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"suffix"},on:{click:e.newSelectData},slot:"suffix"})])],1),r("el-table",{staticClass:"userListTable",attrs:{data:e.tableData}},[r("el-table-column",{attrs:{label:e.$t("views.userList.name"),prop:"username"}}),r("el-table-column",{attrs:{label:e.$t("views.userList.email"),prop:"email"}}),r("el-table-column",{attrs:{label:e.$t("views.userList.role"),prop:"is_superuser"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[e._v(" "+e._s(0===r.is_superuser?"普通用户":"管理员")+" ")]}}])}),r("el-table-column",{attrs:{label:e.$t("views.userList.department"),prop:"department.name"}}),r("el-table-column",{attrs:{label:e.$t("views.userList.phone"),prop:"phone"}}),r("el-table-column",{attrs:{label:e.$t("views.userList.operate"),width:"100px"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[r("i",{staticClass:"iconfont iconshezhi-2 pIcon",on:{click:function(t){return e.userEdit(s)}}}),r("i",{staticClass:"iconfont iconshanchu-6 pIcon",on:{click:function(t){return e.userDelete(s.id)}}})]}}])})],1),r("el-pagination",{staticStyle:{"text-align":"right","margin-top":"10px"},attrs:{layout:"total, prev, pager, next, jumper","hide-on-single-page":e.total>e.pageSize,total:e.total,"page-size":e.pageSize,"current-page":e.page},on:{"current-change":e.currentChange}})],1)]),e.addDialogOpen?r("el-dialog",{attrs:{visible:e.addDialogOpen,top:"8vh",title:e.isAdd?e.$t("views.userList.addUser"):e.$t("views.userList.editUser")},on:{"update:visible":function(t){e.addDialogOpen=t}}},[r("el-form",{ref:"ruleForm",attrs:{"label-width":"150px",model:e.userForm,"status-icon":"",rules:e.rules}},[r("el-form-item",{attrs:{label:e.$t("views.userList.name"),prop:"username"}},[r("el-input",{staticClass:"addUserInput",staticStyle:{width:"400px"},attrs:{placeholder:e.$t("views.userList.namePlaceholder"),clearable:"",size:"small"},model:{value:e.userForm.username,callback:function(t){e.$set(e.userForm,"username",t)},expression:"userForm.username"}})],1),r("el-form-item",{attrs:{label:e.$t("views.userList.email"),prop:"email"}},[r("el-input",{staticClass:"addUserInput",staticStyle:{width:"400px"},attrs:{placeholder:e.$t("views.userList.email"),clearable:"",size:"small"},model:{value:e.userForm.email,callback:function(t){e.$set(e.userForm,"email",t)},expression:"userForm.email"}})],1),r("el-form-item",{attrs:{label:e.$t("views.userList.role")}},[r("el-select",{staticClass:"addUserInput",staticStyle:{width:"400px"},attrs:{clearable:"",size:"small"},model:{value:e.userForm.role,callback:function(t){e.$set(e.userForm,"role",t)},expression:"userForm.role"}},[r("el-option",{attrs:{label:"管理员",value:2}}),r("el-option",{attrs:{label:"普通用户",value:0}})],1)],1),r("el-form-item",{attrs:{label:e.$t("views.userList.department")}},[r("el-input",{staticClass:"addUserInput",staticStyle:{width:"400px"},attrs:{value:e.userForm.department.name,placeholder:e.$t("views.userList.email"),clearable:"",disabled:"",size:"small"}})],1),r("el-form-item",{attrs:{label:e.$t("views.userList.phone"),prop:"phone"}},[r("el-input",{staticClass:"addUserInput",staticStyle:{width:"400px"},attrs:{placeholder:e.$t("views.userList.phonePlaceholder"),clearable:"",size:"small"},model:{value:e.userForm.phone,callback:function(t){e.$set(e.userForm,"phone",t)},expression:"userForm.phone"}})],1),e.userForm.uid?e._e():r("el-form-item",{attrs:{label:e.$t("views.userList.password"),prop:"password"}},[r("el-input",{staticClass:"addUserInput",staticStyle:{width:"400px"},attrs:{"show-password":"",placeholder:e.$t("views.userList.passwordPlaceholder"),clearable:"",size:"small"},model:{value:e.userForm.password,callback:function(t){e.$set(e.userForm,"password",t)},expression:"userForm.password"}})],1),e.userForm.uid?r("el-form-item",{attrs:{label:e.$t("views.userList.password")}},[r("el-input",{staticClass:"addUserInput",staticStyle:{width:"400px"},attrs:{"show-password":"",placeholder:e.$t("views.userList.passwordPlaceholder"),clearable:"",size:"small"},model:{value:e.userForm.password,callback:function(t){e.$set(e.userForm,"password",t)},expression:"userForm.password"}})],1):e._e(),e.userForm.uid?e._e():r("el-form-item",{attrs:{label:e.$t("views.userList.rePass"),prop:"re_password"}},[r("el-input",{staticClass:"addUserInput",staticStyle:{width:"400px"},attrs:{"show-password":"",placeholder:e.$t("views.userList.rePassPlaceholder"),clearable:"",size:"small"},model:{value:e.userForm.re_password,callback:function(t){e.$set(e.userForm,"re_password",t)},expression:"userForm.re_password"}})],1),e.userForm.uid?r("el-form-item",{attrs:{label:e.$t("views.userList.rePass")}},[r("el-input",{staticClass:"addUserInput",staticStyle:{width:"400px"},attrs:{"show-password":"",placeholder:e.$t("views.userList.rePassPlaceholder"),clearable:"",size:"small"},model:{value:e.userForm.re_password,callback:function(t){e.$set(e.userForm,"re_password",t)},expression:"userForm.re_password"}})],1):e._e(),r("el-form-item",[r("el-button",{staticClass:"submitBtn",attrs:{type:"text",size:"small"},on:{click:e.userAdd}},[e._v(e._s(e.$t("views.userList.submit")))]),r("el-button",{staticClass:"cancelBtn",attrs:{type:"text",size:"small"},on:{click:e.cancelAdd}},[e._v(e._s(e.$t("views.userList.cancel")))])],1)],1)],1):e._e()],1)},a=[],i=r("60b5"),n=r("303e"),l=r("acf6"),o=r("e378"),u=r("a8e5"),c=(r("0f45"),r("15ee"),r("1264"),r("6a61"),r("21c9")),d=r("8c73"),p=r("e4a1"),m=function(e){Object(o["a"])(r,e);var t=Object(u["a"])(r);function r(){var e;return Object(n["a"])(this,r),e=t.apply(this,arguments),e.page=1,e.pageSize=20,e.total=0,e.keywords="",e.newDepartment=!1,e.currentDepartmentName="",e.department={id:-1,name:""},e.isAdd=!0,e.tableData=[],e.departments=[],e.addDialogOpen=!1,e.userForm={username:"",password:"",re_password:"",email:"",role:0,department:{},phone:"",uid:0},e.rules={username:[{required:!0,message:e.$t("views.userList.namePlaceholder"),trigger:"blur"}],email:[{required:!0,message:e.$t("views.userList.emailPlaceholder"),trigger:"blur"}],phone:[{required:!0,message:e.$t("views.userList.phonePlaceholder"),trigger:"blur"}],password:[{validator:e.validateNewPass,trigger:"blur"}],re_password:[{validator:e.validateCheckPass,trigger:"blur"}]},e.data=[],e}return Object(l["a"])(r,[{key:"validateNewPass",value:function(e,t,r){""===t?r(new Error("请输入密码")):(""!==this.userForm.password&&this.$refs.ruleForm.validateField("re_password"),r())}},{key:"validateCheckPass",value:function(e,t,r){""===t?r(new Error("请再次输入密码")):t!==this.userForm.password?r(new Error("两次输入密码不一致!")):r()}},{key:"created",value:function(){this.departmentList(),this.getTableData()}},{key:"addDialogShow",value:function(){this.userForm={username:"",password:"",re_password:"",email:"",role:0,department:this.department,phone:"",uid:0},this.addDialogOpen=!0}},{key:"userEdit",value:function(e){this.isAdd=!1,this.userForm={username:e.username,password:"",re_password:"",email:e.email,role:e.is_superuser,department:e.department,phone:e.phone,uid:e.id},this.addDialogOpen=!0}},{key:"cancelAdd",value:function(){this.addDialogOpen=!1,!1===this.isAdd&&(this.isAdd=!0)}},{key:"newSelectData",value:function(){this.page=1,this.getTableData()}},{key:"currentChange",value:function(e){this.page=e,this.getTableData()}},{key:"getTableData",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,r,s,a,i,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={page:this.page,pageSize:this.pageSize,departmentId:this.department.id},this.keywords&&(t.keywords=this.keywords),this.loadingStart(),e.next=5,this.services.user.userList(t);case 5:if(r=e.sent,s=r.status,a=r.msg,i=r.data,n=r.total,this.loadingDone(),201===s){e.next=14;break}return this.$message.error(a),e.abrupt("return");case 14:this.tableData=i,this.total=n;case 16:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"departmentList",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,r,s,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.loadingStart(),e.next=3,this.services.department.departmentList();case 3:if(t=e.sent,r=t.status,s=t.msg,a=t.data,this.loadingDone(),201===r){e.next=11;break}return this.$message.error(s),e.abrupt("return");case 11:this.data=a;case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"userAdd",value:function(){var e=this;this.$refs.ruleForm.validate(function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(r){var s,a,i,n,l,o,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!r){t.next=31;break}if(s={username:e.userForm.username,password:e.userForm.password,re_password:e.userForm.re_password,email:e.userForm.email,role:e.userForm.role,department:e.userForm.department,phone:e.userForm.phone},e.userForm.uid&&(s.uid=e.userForm.uid),console.log(s),e.loadingStart(),!e.isAdd){t.next=17;break}return t.next=8,e.services.user.userAdd(s);case 8:if(a=t.sent,i=a.status,n=a.msg,e.loadingDone(),201===i){t.next=15;break}return e.$message.error(n),t.abrupt("return");case 15:t.next=26;break;case 17:return t.next=19,e.services.user.userEdit(s);case 19:if(l=t.sent,o=l.status,u=l.msg,e.loadingDone(),201===o){t.next=26;break}return e.$message.error(u),t.abrupt("return");case 26:e.addDialogOpen=!1,e.getTableData(),e.isAdd=!0,t.next=33;break;case 31:return console.log("error submit!!"),t.abrupt("return",!1);case 33:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"userDelete",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var r,s,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.loadingStart(),e.next=3,this.services.user.userDelete({uid:t});case 3:if(r=e.sent,s=r.status,a=r.msg,this.loadingDone(),201===s){e.next=10;break}return this.$message.error(a),e.abrupt("return");case 10:return e.next=12,this.getTableData();case 12:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"depatmentAdd",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"departmentDel",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"append",value:function(e,t){this.newDepartment=!0;var r="子部门",s={id:t.id+1,label:"子部门",isEdit:1,children:[]};t.children||this.$set(t,"children",[]),this.currentDepartmentName=r,t.children.push(s)}},{key:"remove",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,r){var s,a,i,n,l,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.services.department.departmentDel(r.id);case 2:s=e.sent,a=s.status,i=s.msg,201===a?(n=t.parent,l=n.data.children||n.data,o=l.findIndex((function(e){return e.id===r.id})),l.splice(o,1),this.$message.success(i)):this.$message.error(i);case 6:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"SelectNode",value:function(e,t,r){t.expanded=!0,(void 0===e.isEdit||0===e.isEdit&&0==this.newDepartment&&-1!==e.id)&&(this.department.id=e.id,this.department.name=e.label,this.getTableData())}},{key:"edit",value:function(e,t){this.newDepartment=!1,this.$set(t,"isEdit",1),this.currentDepartmentName=t.label}},{key:"submitEdit",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,r){var s,a,i,n,l,o,u,c,d,p,m;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r.label!=this.currentDepartmentName){e.next=7;break}console.log("没有修改"),this.currentDepartmentName="",this.$set(r,"isEdit",0),this.newDepartment&&(s=t.parent,a=s.data.children||s.data,i=a.findIndex((function(e){return e.id===r.id})),a.splice(i,1),this.newDepartment=!1),e.next=44;break;case 7:if(n={name:this.currentDepartmentName,parent:t.parent.data.id},!this.newDepartment){e.next=29;break}return e.next=11,this.services.department.departmentAdd(n);case 11:if(l=e.sent,o=l.status,u=l.msg,c=l.data,201===o){e.next=21;break}return this.$set(c,"isEdit",0),this.$message.error(u),e.abrupt("return");case 21:this.$set(r,"id",c),this.$set(r,"label",this.currentDepartmentName),this.currentDepartmentName="",this.$set(r,"isEdit",0),this.$message.success(u);case 26:this.newDepartment=!1,e.next=44;break;case 29:return e.next=31,this.services.department.departmentUpdate(r.id,n);case 31:if(d=e.sent,p=d.status,m=d.msg,201===p){e.next=40;break}return this.$set(r,"isEdit",0),this.$message.error(m),e.abrupt("return");case 40:this.$set(r,"label",this.currentDepartmentName),this.currentDepartmentName="",this.$set(r,"isEdit",0),this.$message.success(m);case 44:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()}]),r}(d["a"]);m=Object(c["c"])([Object(p["a"])({name:"DepartmentList"})],m);var h=m,w=h,f=(r("b0a7"),r("5d22")),v=Object(f["a"])(w,s,a,!1,null,"1e0d87d2",null);t["default"]=v.exports}}]);
//# sourceMappingURL=chunk-4dff9a6e.8de54023.js.map